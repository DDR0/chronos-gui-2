<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Chronos GUI2 Readme</title>
		<style>
			/* from http://bettermotherfuckingwebsite.com */
			body {
				margin:40px auto;
				max-width: 650px;
				line-height: 1.6;
				font-size: 18px;
				color: #444;
				padding: 0 10px;
			}
			
			h1,h2,h3 {
				line-height: 1.2;
			}
		</style>
	</head>
	<body>
		<h1>Chronos GUI2 Readme</h1>
		
		<p>GUI2 is a Python replacement for the C++-based camApp. The original camApp was designed as a monolith, handling the low-level register manipulation through to the high-level GUI. It was decided to break the monolithic camApp apart into two pieces â€“ an API and a GUI â€“ which have clearer responsibilities.</p>
		
		<p>This GUI, <a href="https://github.com/krontech/chronos-gui-2">which can be found on github</a>, relies on the <a href="https://github.com/krontech/chronos-api">Chronos D-Bus API</a> to run. (Although as of time of writing, this is still being split out.)</p>
		
		
		
		<h2>Project Overview</h2>
		
		<p>
			There are five major components to the Chronos project. From lowest level to highest, we have:
			<ul>
				<li>The FPGA driver, which is controlled by the camera API.</li>
				<li>The camera D-Bus API, which controls the FPGA driver and talks to the back-of-camera interface and the HTTP server over D-Bus.</li>
				<li>This, the back of camera interface, which takes input from the operator and controls the camera through the D-Bus API.</li>
				<li>The web server, which exposes an HTTP API for controlling the camera. The server uses the D-Bus API internally. (This is not implemented as of time of writing.)</li>
				<li>The web app, which takes input from the operator and controls the camera through the HTTP API. (This is not implemented as of time of writing.)</li>
			</ul>
		</p>
		
		<p>
			This project implements the back-of-camera interface. The back-of-camera interface itself has has several components:
			<ul>
				<li><a href="src/main.py"><tt>src/main.py</tt></a>: Launch point for the Python interface. (Can be run via <tt>python3 src/main.py</tt>.)</li>
				<li><a href="src/screens/"><tt>src/screens/</tt></a>: This folder holds the files implementing the various screens you visit as you navigate through the UI. Each screen usually consists of a python file providing one class which loads the corresponding .ui file. Each screen is insulated from the other screens, there are no interdependancies. The classes are used by <tt>src/main.py</tt>, which switches between them as needed.</li>
				<li><a href="src/widgets/"><tt>src/widgets/</tt></a>: Custom widgets used by chronos-gui-2. These are used to give constant, custom look and behaviour over the entire application. They're put in the .ui files in <tt>~src/screens</tt> by using QT Designer. Each widget has a <tt>*.py</tt> file and a <tt>*_plugin.py</tt> file. The <tt>*.py</tt> file contains the widget and its behaviour. The <tt>*_plugin.py</tt> file defines the widget for Designer.</li>
				<li><a href="assets/"><tt>assets/</tt></a>: External files, such as images and fonts, used by the application.</li>
				<li><a href="util/"><tt>util/</tt></a>: Miscellaneous resources. Automated deploy scripts, a template for new screens in QT Designer, an example of writing to the framebuffer. See <a href="util/readme.txt"><tt>util/readme.txt</tt></a> for details.</li>
			</ul>
		</p>
		
		
		<h3>Historical Context</h3>
		
		<p>Why did we decide to rewrite our firmware?</p>
		
		<p>In early 2018, our initial implementation of the Chronos 1.4 camera software was starting to cause problems. It wasâ€”quite reasonably at the timeâ€”built as a monolith using Qt 4. This got the kickstarter products out the door. As the product was refined, and more people started working on the code, long-running FPGA projects began conflicting with long-running GUI projects. Refactoring the code became quite difficult, so it was decided to split the initial camera software, the <a href="https://github.com/krontech/chronos-cam-app">camApp</a>, in to two components. One would take care of the FPGA, and one would take care of the UI. They would talk over a <a href="https://www.freedesktop.org/wiki/Software/dbus">D-Bus API</a>.</p>
		
		<p>In the summer of 2018, it became apparent that we would be switching operating systems from Arago Linux to Debian Linux. To enable wifi on the camera, a WIFI dongle can be plugged into the USB port. However, as Arago Linux seems to have ceased development in in 2013, none of the dongles available in 2018 have supported drivers. Running Debian, driver support is much better.</p>
		
		<p>Running Debian also means we can compile modern libraries for our use, which was effectively impossible under Arago. To this end, as we were <a href="http://forum.krontech.ca/index.php?topic=135.0">planning a redesign of the user interface</a> anyway, we decided to take the opportunity to upgrade our GUI library to Qt 5 from Qt 4, and from C++ to Python. This repository contains the "vanilla" Qt 5 Python port. (A Qt Quick 5 Python port is also in the works. One will be chosen as the winner at some point, when we have more experience with both of them.)</p>
		
		
		<h3>Design Considerations</h3>
		
		<ul>
			<li>
				We have the UI .xml files available to us from the original app.
				<li>We will use those files to get us up and running.</li>
				<li>However, the custom C++ widgets are not portable.</li>
			</li>
			<li>The new UI needs to respond to updates from the web app.</li>
			<li>Performance and memory overhead budgets must be respected - the Chronos 1.4 has 1GB memory available to the CPU, which must be shared between the API, the back-of-camera interface, the web server, Debian itself, and Krontech's development tooling.</li>
		</ul>
		
		
		
		<h2>Setup and Running</h2>
		
		
		<h3>Setup</h3>
		
		<p>On your camera, or in a virtual machine, set up Python 3.6.5+ and QT 5.10+ on Debian 7. After configuring your environment to your liking and installing any missing imports required by <tt>src/cam-ui.py</tt>, you can start the UI with <tt>python3 src/cam-ui.py</tt>. If you have some trouble with this, don't worry! This is normal. It took me about 150 discreet steps and two or three weeks to get everything working properly the first time. Luckily for you (hopefully), you can find my edited notes in <a href="util/chronos debian setup instructions.txt">chronos debian setup instructions.txt</a>. Good luck. ðŸ˜¬</p>
		
		
		<h3>Running</h3>
		
		<p>Basic: Run <tt>python3 src/cam-ui.py</tt> on the camera, from the root folder of this project.</p>
		
		<p>Auto-run: Use the <tt>watch-*.sh</tt> scripts, in the <a href="util">util folder</a>, to automatically deploy and run the app as files change during development. See <a href="util/readme.txt"><tt>util/readme.txt</tt></a> for more details on that. One script will handle uploading, one script will handle actually running the camapp.</p>
		
		<p>It is strongly encouraged to set your favourite editor up with some sort of Python linter, such as <a href="http://damnwidget.github.io/anaconda">Anaconda</a>, if it does not already support Python linting. However, <em>any</em> editor or IDE on <em>any</em> operating system may be used. This means the code may be edited using <tt>vi</tt> directly on the camera, which may be simpler than setting up your own development environment.</p>
		
		<p>The <tt>.ui</tt> files are editable with QT Designer. It needs some env vars set to pick up the custom widgets, so the easiest way to run Designer is to run <a href="util/designer.sh"><tt>util/designer.sh</tt></a>.
		
		
		
		<h2>Contributing</h2>
		
		<p>Contributions are welcome! Thank you! Before diving in and changing things, it's a good idea to tell us what you'd like to do on <a href="http://forum.krontech.ca/index.php?board=3.0">the forums</a>. Since we are familiar with the codebase, we can help get you started in the right direction. ðŸ™‚</p>
		
		
		<h3>Known Issues</h3>
		
		<p>See <a href="https://github.com/krontech/chronos-gui-2/issues">https://github.com/krontech/chronos-gui-2/issues</a>.</p>
	</body>
</html>